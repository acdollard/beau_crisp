---
// Testimonials component with expandable cards and carousel functionality
interface Testimonial {
  id: number;
  name: string;
  role: string;
  shortText: string;
  fullText: string;
  rating: number;
}

// Real client testimonials
const testimonials: Testimonial[] = [
  {
    id: 1,
    name: "Cathy Stoner",
    role: "Retired, Ultra Endurance Athlete",
    shortText:
      "As a senior citizen, I've enjoyed many years of an active lifestyle & good health. This was part of my identity & I was proud of that...",
    fullText:
      "As a senior citizen, I've enjoyed many years of an active lifestyle & good health. This was part of my identity & I was proud of that. Gradually, the injuries came- a torn meniscus in each knee; a neck injury (not serious, but with chronic flare ups); various 'overuse' minor injuries. Osteoarthritis came calling and exacerbated the symptoms of the previous insults, resulting in a 4 year 'dark' period in life-- my activity decreased, my weight increased and that literally changed my personality…I had lost a part of my identity. Fortunately, I eventually found a small private gym that trained strength and functional fitness. It was exactly what I needed to get back to 'me'. About 5 years into my gym membership a new coach was hired. Beau Crisp came in with a strength and conditioning background, which opened my eyes and mind to new training possibilities. At one point we had a conversation about tendons & tendinopathy, and I remember thinking 'this guy has information that I need'. I shyly reached out to Beau and asked if he did personal training 'with people like me… old'. He said yes and we've been training together for about 2 years now. I think the best way for me to explain the immense benefits I've gained from my training with Beau is by illustration--- I walked the Camino de Santiago in 2024 at age 68 and signed up for an ultra-endurance event in 2025 at age 69. Each time, when I told Beau what I wanted to do, his response was 'Let's get you ready'. And I was ready when the clock said go. I hope to continue our training together for a long time- both as Coach and friend.",
    rating: 5,
  },
  {
    id: 2,
    name: "Richard Mulder",
    role: "Former Captain & Army Ranger, CEO, CSCS, Strongman",
    shortText:
      "As a former gym owner, athlete, and strength coach, I have 10+ years in the strength and conditioning industry...",
    fullText:
      "As a former gym owner, athlete, and strength coach, I have 10+ years in the strength and conditioning industry as well as a Masters Degree in Exercise and Wellness. Beau's knowledge and unique skillset far surpasses my own. He helped me rebuild two blown out shoulders (two torn rotator cuffs, one torn labrum) and got me feeling stronger, healthier, and more athletic in my late thirties than I have since I was a West Point cadet. He is attentive, thoughtful, and present. Simply put, if you are looking for an individualized training plan and a coach who can adapt to you, there is no one better. Beau just gets it. Learn from him now before he's too popular to teach at such an intimate level.",
    rating: 5,
  },
  {
    id: 3,
    name: "Christian Skeen",
    role: "USAF Captain, Jiujitsu Athlete, Endurance Athlete",
    shortText:
      "Seven years ago, back in college, Beau had written me a training program. At the time, I had no idea that it would be the start of something...",
    fullText:
      "Seven years ago, back in college, Beau had written me a training program. At the time, I had no idea that it would be the start of something that would shape so much of my life. Since then, he's built multiple programs for me, year after year, always tailored to whatever goal I was chasing. Together, we've prepared for and completed a full marathon, a handful of half marathons, and multiple jiu-jitsu competitions. No matter the challenge, I've always felt overly prepared and physically ready to give my best because of the work we put in. He has a gift for pushing me to my limits while keeping training purposeful and enjoyable. Every program is different, yet each one leaves me stronger, faster, and better prepared than before. What's just as impressive is how much he's grown over these years—not just as a coach, but as a person. His knowledge and ability to adapt have only gotten better, and it shows in every workout. I can honestly say his guidance has changed my life. I'm healthier, more confident, and constantly setting new goals I never thought I could reach. I'm excited for what's ahead, because I know we're just getting started. I'm incredibly thankful to have him not just as a coach, but as a friend and brother.",
    rating: 5,
  },
  {
    id: 4,
    name: "Alex Dollard",
    role: "Martial Artist",
    shortText:
      "Beau is by far the best strength and conditioning coach I've ever encountered in my 5+ years of martial arts training...",
    fullText:
      "Beau is by far the best strength and conditioning coach I've ever encountered in my 5+ years of martial arts training. In fact, 'strength and conditioning' as a phrase does not do justice to the holistic and comprehensive approach he takes to athletic performance. He incorporates the nervous system in a way that is, from my experience, totally novel and stunningly effective. Not only has his guidance helped me recover from a rather serious neck injury that damaged the nerves in my arm, but my performance on the mats has noticeably improved. I'm now getting regular comments from training partners telling me that I feel stronger and look bigger. I'm more muscular than I've ever been, and yet I've never felt lighter on my feet. Beau's conditioning programs are the realest deal. It doesn't matter where you're at. If you work with Beau, you will see improvements.",
    rating: 5,
  },
];
---

<section class="py-24 px-4 bg-floralWhite">
  <div class="max-w-7xl mx-auto">
    <h2
      class="text-5xl md:text-6xl font-customFont text-center mb-16 text-ebony"
    >
      What People Are Saying
    </h2>

    <!-- Desktop Grid Layout -->
    <div class="hidden md:grid md:grid-cols-2 gap-6">
      {
        testimonials.map((testimonial) => (
          <div class="testimonial-card bg-white border border-gray-200 rounded-sm p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer group">
            <div class="flex items-center mb-4">
              <div class="flex text-khaki">
                {[...Array(testimonial.rating)].map(() => (
                  <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
            </div>

            <div class="testimonial-content">
              <p class="text-gray-700 mb-4 line-clamp-4 group-hover:line-clamp-none transition-all duration-300">
                {testimonial.shortText}
              </p>
              <div class="testimonial-full hidden group-hover:block">
                <p class="text-gray-700 mb-4">{testimonial.fullText}</p>
              </div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-200">
              <p class="font-semibold text-ebony">{testimonial.name}</p>
              <p class="text-sm text-gray-600">{testimonial.role}</p>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Mobile Carousel -->
    <div class="md:hidden">
      <div class="testimonials-carousel relative">
        <div
          class="testimonials-track flex transition-transform duration-300 ease-in-out"
          id="testimonialsTrack"
        >
          {
            testimonials.map((testimonial, index) => (
              <div
                class="testimonial-slide w-full flex-shrink-0 px-2"
                data-index={index}
              >
                <div class="testimonial-card bg-white border border-gray-200 rounded-sm p-6 shadow-lg">
                  <div class="flex items-center mb-4">
                    <div class="flex text-khaki">
                      {[...Array(testimonial.rating)].map(() => (
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                      ))}
                    </div>
                  </div>

                  <div class="testimonial-content">
                    <p class="text-gray-700 mb-4 testimonial-short">
                      {testimonial.shortText}
                    </p>
                    <p class="text-gray-700 mb-4 testimonial-full hidden">
                      {testimonial.fullText}
                    </p>
                    <button class="text-khaki hover:text-ebony transition-colors duration-200 text-sm font-medium expand-btn">
                      Read More
                    </button>
                  </div>

                  <div class="mt-4 pt-4 border-t border-gray-200">
                    <p class="font-semibold text-ebony">{testimonial.name}</p>
                    <p class="text-sm text-gray-600">{testimonial.role}</p>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <!-- Carousel Navigation -->
        <button
          class="carousel-btn prev absolute left-2 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full p-2 shadow-lg hover:shadow-xl transition-all duration-200 z-10"
        >
          <svg
            class="w-6 h-6 text-ebony"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>

        <button
          class="carousel-btn next absolute right-2 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full p-2 shadow-lg hover:shadow-xl transition-all duration-200 z-10"
        >
          <svg
            class="w-6 h-6 text-ebony"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </button>

        <!-- Carousel Indicators -->
        <div class="flex justify-center mt-6 pb-2 space-x-2">
          {
            testimonials.map((_, index) => (
              <button
                class="carousel-indicator w-3 h-3 rounded-full bg-gray-300 transition-all duration-200"
                data-index={index}
              />
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .line-clamp-4 {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-none {
    -webkit-line-clamp: unset;
  }

  .testimonial-card {
    min-height: 300px;
    display: flex;
    flex-direction: column;
  }

  .testimonial-content {
    flex: 1;
  }

  .testimonials-carousel {
    overflow: hidden;
  }

  .testimonials-track {
    width: 400%; /* 4 slides * 100% */
  }

  .testimonial-slide {
    width: 25%; /* Each slide takes 25% of the track width (100% / 4 slides) */
  }

  .carousel-indicator.active {
    background-color: #8b7355; /* khaki color */
    transform: scale(1.2);
  }

  .carousel-btn:hover {
    background-color: #f8f8f8;
  }

  .carousel-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Mobile carousel functionality
    const track = document.getElementById("testimonialsTrack");
    const slides = document.querySelectorAll(".testimonial-slide");
    const indicators = document.querySelectorAll(".carousel-indicator");
    const prevBtn = document.querySelector(".carousel-btn.prev");
    const nextBtn = document.querySelector(".carousel-btn.next");

    if (!track || slides.length === 0) return;

    let currentIndex = 0;
    const slideWidth = 25; // Each slide is 25% of the track width

    function updateCarousel() {
      if (track) {
        track.style.transform = `translateX(-${currentIndex * slideWidth}%)`;
      }

      // Update indicators
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle("active", index === currentIndex);
      });

      // Update button states
      if (prevBtn instanceof HTMLButtonElement) {
        prevBtn.disabled = currentIndex === 0;
      }
      if (nextBtn instanceof HTMLButtonElement) {
        nextBtn.disabled = currentIndex === slides.length - 1;
      }
    }

    // Navigation buttons
    prevBtn?.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateCarousel();
      }
    });

    nextBtn?.addEventListener("click", () => {
      if (currentIndex < slides.length - 1) {
        currentIndex++;
        updateCarousel();
      }
    });

    // Indicator clicks
    indicators.forEach((indicator, index) => {
      indicator.addEventListener("click", () => {
        currentIndex = index;
        updateCarousel();
      });
    });

    // Expand/collapse functionality for mobile
    const expandBtns = document.querySelectorAll(".expand-btn");
    expandBtns.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const card = btn.closest(".testimonial-card");
        if (!card) return;

        const shortText = card.querySelector(".testimonial-short");
        const fullText = card.querySelector(".testimonial-full");
        if (!shortText || !fullText) return;

        const isExpanded = fullText.classList.contains("hidden");

        if (isExpanded) {
          shortText.classList.add("hidden");
          fullText.classList.remove("hidden");
          btn.textContent = "Read Less";
        } else {
          shortText.classList.remove("hidden");
          fullText.classList.add("hidden");
          btn.textContent = "Read More";
        }
      });
    });

    // Initialize carousel
    updateCarousel();

    // Auto-advance carousel (optional)
    let autoAdvance = setInterval(() => {
      if (currentIndex < slides.length - 1) {
        currentIndex++;
      } else {
        currentIndex = 0;
      }
      updateCarousel();
    }, 5000);

    // Pause auto-advance on hover
    const carousel = document.querySelector(".testimonials-carousel");
    carousel?.addEventListener("mouseenter", () => {
      clearInterval(autoAdvance);
    });

    carousel?.addEventListener("mouseleave", () => {
      autoAdvance = setInterval(() => {
        if (currentIndex < slides.length - 1) {
          currentIndex++;
        } else {
          currentIndex = 0;
        }
        updateCarousel();
      }, 5000);
    });
  });
</script>
